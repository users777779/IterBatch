# 回归任务性能测试指南

## 概述
本指南介绍如何使用 `performance_test.py` 脚本测试不同训练策略下模型的准确率、训练速度等性能指标。该脚本支持对四种训练策略进行全面比较：基线策略、ABR策略、可学习调度策略和滑动窗口策略。

## 测试脚本功能
- 支持多次运行每种策略，计算平均值和标准差，提高结果可靠性
- 记录多种性能指标：训练时间、平均重复次数/批次、测试RMSE和测试MAE
- 生成可视化图表，直观比较不同策略的性能差异
- 将结果保存到CSV文件，便于进一步分析

## 使用方法

### 前提条件
1. 确保已安装所有依赖项
2. 激活conda环境：
   ```bash
   conda activate abr-regression
   ```

### 基本运行
```bash
cd d:\Personal\Desktop\【科研实验】\IterBatch\experiments\regression
python performance_test.py
```

### 命令行参数
可以通过命令行参数调整测试设置：

```bash
python performance_test.py --dataset california --batch_size 5 --epochs 5 --lr 0.001 --num_runs 3
```

参数说明：
- `--dataset`: 选择数据集 (california/boston)，默认为california
- `--batch_size`: 批次大小，默认为5
- `--epochs`: 训练轮数，默认为5
- `--lr`: 学习率，默认为0.001
- `--hidden_dim`: 隐藏层维度，默认为64
- `--loss_threshold`: ABR策略的损失阈值，默认为0.5
- `--max_repeats`: ABR策略的最大重复次数，默认为5
- `--window_size`: 滑动窗口策略的窗口大小，默认为5
- `--save_dir`: 结果保存目录，默认为performance_results
- `--num_runs`: 每种策略运行的次数，取平均值，默认为3

## 测试结果解读

### 输出文件
运行脚本后，将在指定的保存目录中生成以下文件：

1. `performance_comparison.csv`: 包含所有策略的平均性能指标
2. 四种策略的指标历史数据文件（`.npy`格式）
3. 四张可视化图表：
   - `training_time_comparison.png`: 训练时间比较
   - `rmse_comparison.png`: 测试RMSE比较
   - `mae_comparison.png`: 测试MAE比较
   - `repeats_comparison.png`: 重复训练次数比较

### 性能指标说明

1. **训练时间**：完成指定训练轮次所需的总时间（秒）
2. **平均重复次数/批次**：每个训练批次的平均重复训练次数
3. **测试RMSE**：在测试集上的均方根误差
4. **测试MAE**：在测试集上的平均绝对误差

### 图表解读

- **训练时间比较**：展示不同策略的训练效率
- **RMSE/MAE比较**：展示不同策略的预测准确性
- **重复次数比较**：展示不同策略的自适应训练特性

## 示例结果分析

假设我们得到以下结果：

| 策略           | 平均训练时间 (秒) | 平均重复次数/批次 | 平均测试RMSE | 平均测试MAE |
|----------------|------------------|------------------|--------------|-------------|
| baseline       | 120.5            | 1.0              | 0.512        | 0.398       |
| abr            | 145.2            | 1.8              | 0.508        | 0.393       |
| learnable      | 180.7            | 2.2              | 0.510        | 0.395       |
| window         | 155.3            | 1.6              | 0.511        | 0.396       |

分析：
1. ABR策略在略微增加训练时间的情况下，取得了最低的RMSE和MAE，表明其在准确性上的优势
2. 可学习策略训练时间最长，但性能提升不明显，可能需要进一步调优
3. 滑动窗口策略平衡了训练时间和性能
4. 基线策略最快但准确性最低

## 注意事项
1. 首次运行可能需要下载数据集，请确保网络连接正常
2. 增加 `--num_runs` 参数可以提高结果的可靠性，但会增加总运行时间
3. 不同硬件环境下的绝对时间值可能有差异，建议关注相对比较结果
4. 如需调整实验参数，请修改命令行参数或脚本代码

## 扩展建议
1. 测试更多的超参数组合，如不同的学习率、批次大小
2. 增加其他性能指标，如训练过程中的内存使用
3. 对比不同模型架构下各策略的表现
4. 测试在更大规模数据集上的性能